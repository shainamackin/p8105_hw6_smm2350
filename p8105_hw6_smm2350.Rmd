---
title: "p8105_hw6_smm2350"
author: "Shaina Mackin"
date: "12/1/2021"
output: github_document
---

# Homework 6

To begin, I'll load libraries and set themes.

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(rvest)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

I'll first load the birthweight dataset...
```{r import1}
bwt_data = read.csv("/Users/shainamackin/Desktop/Fall 2021/Data Science I/p8105_hw6_smm2350/data/birthweight.csv")
```

... and then clean it by tidying variable names and factoring when relevant so that it's ready for regression analysis. 
```{r clean1}
bwt_df = bwt_data %>%
  mutate(
    babysex = factor(babysex),
    frace = factor(frace),
    malform = factor(malform),
    mrace = factor(mrace)
  ) %>%
  mutate(
    babysex = fct_recode(babysex, "male" = '1'),
    babysex = fct_recode(babysex, "female" = '2'),
    frace = fct_recode(frace, "white" = '1'),
    frace = fct_recode(frace, "black" = '2'),
    frace = fct_recode(frace, "asian" = '3'),
    frace = fct_recode(frace, "puerto rican" = '4'),
    frace = fct_recode(frace, "other" = '8'),
    malform = fct_recode(malform, "absent" = '0'),
    malform = fct_recode(malform, "present" = '1'),
    mrace = fct_recode(mrace, "white" = '1'),
    mrace = fct_recode(mrace, "black" = '2'),
    mrace = fct_recode(mrace, "asian" = '3'),
    mrace = fct_recode(mrace, "puerto rican" = '4')
    ) %>%
  drop_na() %>%
  janitor::clean_names()
```

I'll build a linear regression model for birthweight using backwards selection. First, I'll include all variables as predictors in my fully saturated model:  
```{r}
saturated_fit = lm(bwt ~., data = bwt_df)

saturated_fit%>%broom::tidy()%>%knitr::kable()
```

Second, I'll run a backward selection using `stepAIC` from the `MASS` package to remove all non-significant predictors in the model. 
```{r}
reduced_fit = MASS::stepAIC(saturated_fit, direction = "backward", trace = FALSE)

reduced_fit%>%broom::tidy() %>%knitr::kable()
```
All coefficients in this reduced model are now statistically significant. 

The [literature](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3390317/) confirms that smoking exposure, maternal weight, weight gain during pregnancy, and previous LBW babies are all associated with birthweight (Metgud et al., 2012). Race and income should also be kept in the model, as they are statistically significant and increasingly recognized as social determinants of maternal & neonatal health outcomes. We will also keep height, gestational age, baby's length, head circumference, and sex in the model, as they are statistically significant and clinically relevant to birthweight. 

`reduced_fit` is thus my proposed model, including `babysex`, `bhead`, `blength`, `delwt`, `fincome`, `gaweeks`, `mheight`, `race`, `parity`, `ppwt`, and `smoken`.

```{r}
modelr::add_residuals(bwt_df, reduced_fit)

modelr::add_predictions(bwt_df, reduced_fit)

bwt_df %>% 
  modelr::add_residuals(reduced_fit) %>% 
  ggplot(aes(x = , y = resid)) + geom_violin()

nyc_airbnb %>% 
  modelr::add_residuals(fit) %>% 
  ggplot(aes(x = stars, y = resid)) + geom_point()
```


## Problem 2

```{r import2}
```


